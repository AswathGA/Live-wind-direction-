<!DOCTYPE html>
<html>
<head>
    <title>Simple Wind Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .anemometer { 
            border: 1px solid #ccc; 
            margin: 10px; 
            padding: 15px; 
            background: #f9f9f9;
            border-radius: 5px;
        }
        .windrose {
            width: 100px;
            height: 100px;
            border: 2px solid #000;
            border-radius: 50%;
            position: relative;
            margin: 10px auto;
            background: #fff;
        }
        .needle {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 2px;
            height: 40px;
            background: red;
            transform-origin: 50% 100%;
            transform: translate(-50%, -100%);
            transition: transform 0.5s ease;
        }
        .center-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 6px;
            height: 6px;
            background: #000;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        #status { 
            padding: 10px; 
            background: #e0e0e0; 
            margin: 10px 0; 
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>üå™Ô∏è Simple Wind Test</h1>
    
    <div id="status">Loading...</div>
    
    <div id="data-container">
        <p>Waiting for data...</p>
    </div>

    <script>
        function updateData() {
            console.log('Fetching data...');
            
            fetch('/api/wind_data')
                .then(response => {
                    console.log('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Full API Response:', data);
                    
                    document.getElementById('status').innerHTML = 
                        '‚úÖ API Response received at ' + new Date().toLocaleTimeString();
                    
                    let html = '';
                    let windData = null;
                    
                    // Try to extract wind data from different formats
                    if (data && data.data) {
                        windData = data.data;
                        html += '<p>üìä Using response.data format</p>';
                    } else if (data && typeof data === 'object') {
                        windData = data;
                        html += '<p>üìä Using direct response format</p>';
                    }
                    
                    if (windData && Object.keys(windData).length > 0) {
                        html += '<h3>üå™Ô∏è Wind Data Found:</h3>';
                        
                        for (const [key, anemometer] of Object.entries(windData)) {
                            const speed = anemometer.wind_speed || 0;
                            const direction = anemometer.wind_direction || 0;
                            const port = anemometer.port || 'Unknown';
                            const id = anemometer.anemometer_id || 'Unknown';
                            const temp = anemometer.temperature || 0;
                            
                            html += `
                                <div class="anemometer">
                                    <h4>${key} (${id} on ${port})</h4>
                                    <div class="windrose">
                                        <div class="needle" style="transform: translate(-50%, -100%) rotate(${direction}deg);"></div>
                                        <div class="center-dot"></div>
                                    </div>
                                    <p><strong>Speed:</strong> ${speed} m/s</p>
                                    <p><strong>Direction:</strong> ${direction}¬∞</p>
                                    <p><strong>Temperature:</strong> ${temp}¬∞C</p>
                                </div>
                            `;
                        }
                    } else {
                        html += '<p>‚ùå No wind data found in response</p>';
                        html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                    }
                    
                    document.getElementById('data-container').innerHTML = html;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('status').innerHTML = 
                        '‚ùå Error: ' + error.message;
                    document.getElementById('data-container').innerHTML = 
                        '<p>‚ùå Failed to load data: ' + error.message + '</p>';
                });
        }

        // Update immediately and then every 3 seconds
        updateData();
        setInterval(updateData, 3000);
    </script>
</body>
</html>
